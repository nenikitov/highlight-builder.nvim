local Color = require('highlight_builder.color')

---@alias PaletteCustomColorInput string | Color.Gui

---@class PaletteCustomPrimary
---@field fg PaletteCustomColorInput
---@field bg PaletteCustomColorInput

---@class PaletteCustomColors
---@field black PaletteCustomColorInput
---@field red PaletteCustomColorInput
---@field green PaletteCustomColorInput
---@field yellow PaletteCustomColorInput
---@field blue PaletteCustomColorInput
---@field magenta PaletteCustomColorInput
---@field cyan PaletteCustomColorInput
---@field white PaletteCustomColorInput

---@class PaletteCustom
---@field primary PaletteCustomPrimary
---@field dark PaletteCustomColors
---@field bright PaletteCustomColors

local to_256 = {
    Color.Gui.from_hex('#000000'),
    Color.Gui.from_hex('#00005F'),
    Color.Gui.from_hex('#000087'),
    Color.Gui.from_hex('#0000AF'),
    Color.Gui.from_hex('#0000D7'),
    Color.Gui.from_hex('#0000FF'),
    Color.Gui.from_hex('#005F00'),
    Color.Gui.from_hex('#005F5F'),
    Color.Gui.from_hex('#005F87'),
    Color.Gui.from_hex('#005FAF'),
    Color.Gui.from_hex('#005FD7'),
    Color.Gui.from_hex('#005FFF'),
    Color.Gui.from_hex('#008700'),
    Color.Gui.from_hex('#00875F'),
    Color.Gui.from_hex('#008787'),
    Color.Gui.from_hex('#0087AF'),
    Color.Gui.from_hex('#0087D7'),
    Color.Gui.from_hex('#0087FF'),
    Color.Gui.from_hex('#00AF00'),
    Color.Gui.from_hex('#00AF5F'),
    Color.Gui.from_hex('#00AF87'),
    Color.Gui.from_hex('#00AFAF'),
    Color.Gui.from_hex('#00AFD7'),
    Color.Gui.from_hex('#00AFFF'),
    Color.Gui.from_hex('#00D700'),
    Color.Gui.from_hex('#00D75F'),
    Color.Gui.from_hex('#00D787'),
    Color.Gui.from_hex('#00D7AF'),
    Color.Gui.from_hex('#00D7D7'),
    Color.Gui.from_hex('#00D7FF'),
    Color.Gui.from_hex('#00FF00'),
    Color.Gui.from_hex('#00FF5F'),
    Color.Gui.from_hex('#00FF87'),
    Color.Gui.from_hex('#00FFAF'),
    Color.Gui.from_hex('#00FFD7'),
    Color.Gui.from_hex('#00FFFF'),
    Color.Gui.from_hex('#5F0000'),
    Color.Gui.from_hex('#5F005F'),
    Color.Gui.from_hex('#5F0087'),
    Color.Gui.from_hex('#5F00AF'),
    Color.Gui.from_hex('#5F00D7'),
    Color.Gui.from_hex('#5F00FF'),
    Color.Gui.from_hex('#5F5F00'),
    Color.Gui.from_hex('#5F5F5F'),
    Color.Gui.from_hex('#5F5F87'),
    Color.Gui.from_hex('#5F5FAF'),
    Color.Gui.from_hex('#5F5FD7'),
    Color.Gui.from_hex('#5F5FFF'),
    Color.Gui.from_hex('#5F8700'),
    Color.Gui.from_hex('#5F875F'),
    Color.Gui.from_hex('#5F8787'),
    Color.Gui.from_hex('#5F87AF'),
    Color.Gui.from_hex('#5F87D7'),
    Color.Gui.from_hex('#5F87FF'),
    Color.Gui.from_hex('#5FAF00'),
    Color.Gui.from_hex('#5FAF5F'),
    Color.Gui.from_hex('#5FAF87'),
    Color.Gui.from_hex('#5FAFAF'),
    Color.Gui.from_hex('#5FAFD7'),
    Color.Gui.from_hex('#5FAFFF'),
    Color.Gui.from_hex('#5FD700'),
    Color.Gui.from_hex('#5FD75F'),
    Color.Gui.from_hex('#5FD787'),
    Color.Gui.from_hex('#5FD7AF'),
    Color.Gui.from_hex('#5FD7D7'),
    Color.Gui.from_hex('#5FD7FF'),
    Color.Gui.from_hex('#5FFF00'),
    Color.Gui.from_hex('#5FFF5F'),
    Color.Gui.from_hex('#5FFF87'),
    Color.Gui.from_hex('#5FFFAF'),
    Color.Gui.from_hex('#5FFFD7'),
    Color.Gui.from_hex('#5FFFFF'),
    Color.Gui.from_hex('#870000'),
    Color.Gui.from_hex('#87005F'),
    Color.Gui.from_hex('#870087'),
    Color.Gui.from_hex('#8700AF'),
    Color.Gui.from_hex('#8700D7'),
    Color.Gui.from_hex('#8700FF'),
    Color.Gui.from_hex('#875F00'),
    Color.Gui.from_hex('#875F5F'),
    Color.Gui.from_hex('#875F87'),
    Color.Gui.from_hex('#875FAF'),
    Color.Gui.from_hex('#875FD7'),
    Color.Gui.from_hex('#875FFF'),
    Color.Gui.from_hex('#878700'),
    Color.Gui.from_hex('#87875F'),
    Color.Gui.from_hex('#878787'),
    Color.Gui.from_hex('#8787AF'),
    Color.Gui.from_hex('#8787D7'),
    Color.Gui.from_hex('#8787FF'),
    Color.Gui.from_hex('#87AF00'),
    Color.Gui.from_hex('#87AF5F'),
    Color.Gui.from_hex('#87AF87'),
    Color.Gui.from_hex('#87AFAF'),
    Color.Gui.from_hex('#87AFD7'),
    Color.Gui.from_hex('#87AFFF'),
    Color.Gui.from_hex('#87D700'),
    Color.Gui.from_hex('#87D75F'),
    Color.Gui.from_hex('#87D787'),
    Color.Gui.from_hex('#87D7AF'),
    Color.Gui.from_hex('#87D7D7'),
    Color.Gui.from_hex('#87D7FF'),
    Color.Gui.from_hex('#87FF00'),
    Color.Gui.from_hex('#87FF5F'),
    Color.Gui.from_hex('#87FF87'),
    Color.Gui.from_hex('#87FFAF'),
    Color.Gui.from_hex('#87FFD7'),
    Color.Gui.from_hex('#87FFFF'),
    Color.Gui.from_hex('#AF0000'),
    Color.Gui.from_hex('#AF005F'),
    Color.Gui.from_hex('#AF0087'),
    Color.Gui.from_hex('#AF00AF'),
    Color.Gui.from_hex('#AF00D7'),
    Color.Gui.from_hex('#AF00FF'),
    Color.Gui.from_hex('#AF5F00'),
    Color.Gui.from_hex('#AF5F5F'),
    Color.Gui.from_hex('#AF5F87'),
    Color.Gui.from_hex('#AF5FAF'),
    Color.Gui.from_hex('#AF5FD7'),
    Color.Gui.from_hex('#AF5FFF'),
    Color.Gui.from_hex('#AF8700'),
    Color.Gui.from_hex('#AF875F'),
    Color.Gui.from_hex('#AF8787'),
    Color.Gui.from_hex('#AF87AF'),
    Color.Gui.from_hex('#AF87D7'),
    Color.Gui.from_hex('#AF87FF'),
    Color.Gui.from_hex('#AFAF00'),
    Color.Gui.from_hex('#AFAF5F'),
    Color.Gui.from_hex('#AFAF87'),
    Color.Gui.from_hex('#AFAFAF'),
    Color.Gui.from_hex('#AFAFD7'),
    Color.Gui.from_hex('#AFAFFF'),
    Color.Gui.from_hex('#AFD700'),
    Color.Gui.from_hex('#AFD75F'),
    Color.Gui.from_hex('#AFD787'),
    Color.Gui.from_hex('#AFD7AF'),
    Color.Gui.from_hex('#AFD7D7'),
    Color.Gui.from_hex('#AFD7FF'),
    Color.Gui.from_hex('#AFFF00'),
    Color.Gui.from_hex('#AFFF5F'),
    Color.Gui.from_hex('#AFFF87'),
    Color.Gui.from_hex('#AFFFAF'),
    Color.Gui.from_hex('#AFFFD7'),
    Color.Gui.from_hex('#AFFFFF'),
    Color.Gui.from_hex('#D70000'),
    Color.Gui.from_hex('#D7005F'),
    Color.Gui.from_hex('#D70087'),
    Color.Gui.from_hex('#D700AF'),
    Color.Gui.from_hex('#D700D7'),
    Color.Gui.from_hex('#D700FF'),
    Color.Gui.from_hex('#D75F00'),
    Color.Gui.from_hex('#D75F5F'),
    Color.Gui.from_hex('#D75F87'),
    Color.Gui.from_hex('#D75FAF'),
    Color.Gui.from_hex('#D75FD7'),
    Color.Gui.from_hex('#D75FFF'),
    Color.Gui.from_hex('#D78700'),
    Color.Gui.from_hex('#D7875F'),
    Color.Gui.from_hex('#D78787'),
    Color.Gui.from_hex('#D787AF'),
    Color.Gui.from_hex('#D787D7'),
    Color.Gui.from_hex('#D787FF'),
    Color.Gui.from_hex('#D7AF00'),
    Color.Gui.from_hex('#D7AF5F'),
    Color.Gui.from_hex('#D7AF87'),
    Color.Gui.from_hex('#D7AFAF'),
    Color.Gui.from_hex('#D7AFD7'),
    Color.Gui.from_hex('#D7AFFF'),
    Color.Gui.from_hex('#D7D700'),
    Color.Gui.from_hex('#D7D75F'),
    Color.Gui.from_hex('#D7D787'),
    Color.Gui.from_hex('#D7D7AF'),
    Color.Gui.from_hex('#D7D7D7'),
    Color.Gui.from_hex('#D7D7FF'),
    Color.Gui.from_hex('#D7FF00'),
    Color.Gui.from_hex('#D7FF5F'),
    Color.Gui.from_hex('#D7FF87'),
    Color.Gui.from_hex('#D7FFAF'),
    Color.Gui.from_hex('#D7FFD7'),
    Color.Gui.from_hex('#D7FFFF'),
    Color.Gui.from_hex('#FF0000'),
    Color.Gui.from_hex('#FF005F'),
    Color.Gui.from_hex('#FF0087'),
    Color.Gui.from_hex('#FF00AF'),
    Color.Gui.from_hex('#FF00D7'),
    Color.Gui.from_hex('#FF00FF'),
    Color.Gui.from_hex('#FF5F00'),
    Color.Gui.from_hex('#FF5F5F'),
    Color.Gui.from_hex('#FF5F87'),
    Color.Gui.from_hex('#FF5FAF'),
    Color.Gui.from_hex('#FF5FD7'),
    Color.Gui.from_hex('#FF5FFF'),
    Color.Gui.from_hex('#FF8700'),
    Color.Gui.from_hex('#FF875F'),
    Color.Gui.from_hex('#FF8787'),
    Color.Gui.from_hex('#FF87AF'),
    Color.Gui.from_hex('#FF87D7'),
    Color.Gui.from_hex('#FF87FF'),
    Color.Gui.from_hex('#FFAF00'),
    Color.Gui.from_hex('#FFAF5F'),
    Color.Gui.from_hex('#FFAF87'),
    Color.Gui.from_hex('#FFAFAF'),
    Color.Gui.from_hex('#FFAFD7'),
    Color.Gui.from_hex('#FFAFFF'),
    Color.Gui.from_hex('#FFD700'),
    Color.Gui.from_hex('#FFD75F'),
    Color.Gui.from_hex('#FFD787'),
    Color.Gui.from_hex('#FFD7AF'),
    Color.Gui.from_hex('#FFD7D7'),
    Color.Gui.from_hex('#FFD7FF'),
    Color.Gui.from_hex('#FFFF00'),
    Color.Gui.from_hex('#FFFF5F'),
    Color.Gui.from_hex('#FFFF87'),
    Color.Gui.from_hex('#FFFFAF'),
    Color.Gui.from_hex('#FFFFD7'),
    Color.Gui.from_hex('#FFFFFF'),
    Color.Gui.from_hex('#080808'),
    Color.Gui.from_hex('#121212'),
    Color.Gui.from_hex('#1C1C1C'),
    Color.Gui.from_hex('#262626'),
    Color.Gui.from_hex('#303030'),
    Color.Gui.from_hex('#3A3A3A'),
    Color.Gui.from_hex('#444444'),
    Color.Gui.from_hex('#4E4E4E'),
    Color.Gui.from_hex('#585858'),
    Color.Gui.from_hex('#626262'),
    Color.Gui.from_hex('#6C6C6C'),
    Color.Gui.from_hex('#767676'),
    Color.Gui.from_hex('#808080'),
    Color.Gui.from_hex('#8A8A8A'),
    Color.Gui.from_hex('#949494'),
    Color.Gui.from_hex('#9E9E9E'),
    Color.Gui.from_hex('#A8A8A8'),
    Color.Gui.from_hex('#B2B2B2'),
    Color.Gui.from_hex('#BCBCBC'),
    Color.Gui.from_hex('#C6C6C6'),
    Color.Gui.from_hex('#D0D0D0'),
    Color.Gui.from_hex('#DADADA'),
    Color.Gui.from_hex('#E4E4E4'),
    Color.Gui.from_hex('#EEEEEE'),
}

---@param c PaletteCustomColorInput
---@return Color.Gui
local function color(c)
    if type(c) == 'string' then
        return Color.Gui.from_hex(c)
    end
    ---@cast c -string
    return c
end

---@param palette PaletteCustom
---@param complete_to_256 boolean
---@return Palette
return function(palette, complete_to_256)
    ---@type Palette
    local p = {
        primary = {
            fg = color(palette.primary.fg),
            bg = color(palette.primary.bg),
        },
        indexed = {
            color(palette.dark.black),
            color(palette.dark.red),
            color(palette.dark.green),
            color(palette.dark.yellow),
            color(palette.dark.blue),
            color(palette.dark.magenta),
            color(palette.dark.cyan),
            color(palette.dark.white),
            color(palette.bright.black),
            color(palette.bright.red),
            color(palette.bright.green),
            color(palette.bright.yellow),
            color(palette.bright.blue),
            color(palette.bright.magenta),
            color(palette.bright.cyan),
            color(palette.bright.white),
        },
    }

    if complete_to_256 then
        for _, c in ipairs(to_256) do
            p.indexed[#p.indexed + 1] = c
        end
    end

    return p
end
